<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>scistanpy.plotting.prior_predictive &#8212; SciStanPy Alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=6b921976"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for scistanpy.plotting.prior_predictive</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) Microsoft Corporation.</span>
<span class="c1"># Licensed under the MIT license.</span>


<span class="sd">&quot;&quot;&quot;Interactive prior predictive check functionality for SciStanPy models.</span>

<span class="sd">This module provides interactive widgets and visualizations for conducting</span>
<span class="sd">prior predictive checks on SciStanPy models. Prior predictive checks allow</span>
<span class="sd">users to examine the behavior of their models before fitting to data by</span>
<span class="sd">sampling from prior distributions and visualizing the resulting predictions.</span>

<span class="sd">The module centers around the :py:class:`~scistanpy.plotting.prior_predictive.PriorPredictiveCheck`</span>
<span class="sd">class, which creates an interactive dashboard with sliders for model hyperparameters</span>
<span class="sd">and dropdown menus for selecting visualization options. This enables rapid</span>
<span class="sd">exploration of how different prior specifications affect model behavior.</span>

<span class="sd">The interface automatically adapts to the structure of the provided model,</span>
<span class="sd">exposing only relevant parameters and visualization options based on the</span>
<span class="sd">data dimensions and available coordinates.</span>

<span class="sd">.. note::</span>
<span class="sd">    Instances of the :py:class:`~scistanpy.plotting.prior_predictive.PriorPredictiveCheck`</span>
<span class="sd">    class will not typically be accessed directly by users. Instead, they are accessed</span>
<span class="sd">    via the :py:meth:`Model.prior_predictive() &lt;~scistanpy.model.Model.prior_predictive&gt;`</span>
<span class="sd">    method.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">holoviews</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hvplot.pandas</span>  <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">panel.widgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pnw</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">param.parameterized</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scistanpy.model.components</span><span class="w"> </span><span class="kn">import</span> <span class="n">constants</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scistanpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">model</span> <span class="k">as</span> <span class="n">ssp_model</span>

<span class="c1"># We need a regular expression for separating the variable name from its indices</span>
<span class="n">_INDEX_EXTRACTOR</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Za-z0-9_\.]+)\[?([0-9, ]*)\]?&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="PriorPredictiveCheck">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PriorPredictiveCheck</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interactive dashboard for conducting prior predictive checks.</span>

<span class="sd">    This class creates a comprehensive interface for exploring model behavior</span>
<span class="sd">    through prior predictive sampling. It automatically generates appropriate</span>
<span class="sd">    widgets based on the model structure and provides multiple visualization</span>
<span class="sd">    modes for examining parameter distributions and relationships.</span>

<span class="sd">    :param model: SciStanPy model to analyze</span>
<span class="sd">    :type model: ssp_model.Model</span>
<span class="sd">    :param copy_model: Whether to create a copy of the model to avoid modifying the original.</span>
<span class="sd">                      Defaults to False, meaning updates to model parameters in the</span>
<span class="sd">                      interactive plot will be reflected in the original model object.</span>
<span class="sd">    :type copy_model: bool</span>

<span class="sd">    :ivar model: The model being analyzed (copy or reference)</span>
<span class="sd">    :ivar float_sliders: Dictionary of parameter adjustment sliders</span>
<span class="sd">    :ivar target_dropdown: Widget for selecting which parameter to visualize</span>
<span class="sd">    :ivar group_dim_dropdown: Widget for selecting grouping dimension</span>
<span class="sd">    :ivar independent_var_dropdown: Widget for selecting independent variable</span>
<span class="sd">    :ivar plot_type_dropdown: Widget for selecting visualization type</span>
<span class="sd">    :ivar draw_seed_entry: Widget for setting random seed</span>
<span class="sd">    :ivar draw_entry: Widget for setting number of experiments</span>
<span class="sd">    :ivar update_model_button: Button to update model and redraw data</span>
<span class="sd">    :ivar update_plot_button: Button to update plot without redrawing data</span>
<span class="sd">    :ivar fig: HoloViews pane containing the current plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="s2">&quot;ssp_model.Model&quot;</span><span class="p">,</span> <span class="n">copy_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Copy the model if requested. If we don&#39;t copy, then we can modify our</span>
        <span class="c1"># values on the model directly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="k">if</span> <span class="n">copy_model</span> <span class="k">else</span> <span class="n">model</span>

        <span class="c1"># Initialize widgets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">float_sliders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_float_sliders</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Viewed Parameter&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span>
                <span class="n">k</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_model_components_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">Constant</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">observables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model_varname</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Group By&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[],</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Independent Variable&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[],</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Plot Type&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[],</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;ECDF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_seed_entry</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">IntInput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1025</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_entry</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">IntInput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Number of Experiments&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_model_button</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Update Model&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Update Plot&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>

        <span class="c1"># We need additional components for the plotting data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">HoloViews</span><span class="p">(</span>
            <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">([]),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_both&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># The update model button will run the full pipeline, including drawing new</span>
        <span class="c1"># data and updating the plot. The update plot button will only update the</span>
        <span class="c1"># plot, without redrawing the data.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_model_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_pipeline</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">)</span>

        <span class="c1"># We need to store the data and the plotting data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Draw initial data. We need this for setting up the remaining reactive</span>
        <span class="c1"># components. This will set the `_xarray_data` attribute.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span><span class="p">()</span>

        <span class="c1"># Create reactive components whose values depend on the data. These components</span>
        <span class="c1"># have no effect on the data that is drawn, only what is shown.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_group_dim_options</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_independent_var_options</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_plot_type_options</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_plot_type_options</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

        <span class="c1"># Set initial values for the components relevant to showing data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

        <span class="c1"># Run the full pipeline to set up the plotting data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_pipeline</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_float_sliders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pnw</span><span class="o">.</span><span class="n">EditableFloatSlider</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize float sliders for toggleable model parameters.</span>

<span class="sd">        This method scans the model for constant parameters marked as toggleable</span>
<span class="sd">        and creates appropriate slider widgets for interactive adjustment. It</span>
<span class="sd">        handles both scalar and multi-dimensional parameters appropriately.</span>

<span class="sd">        :returns: Dictionary mapping parameter names to slider widgets</span>
<span class="sd">        :rtype: dict[str, pnw.EditableFloatSlider]</span>

<span class="sd">        For scalar parameters or those with enforced uniformity, a single slider</span>
<span class="sd">        is created. For multi-dimensional parameters, individual sliders are</span>
<span class="sd">        created for each array element with indexed naming conventions.</span>

<span class="sd">        Slider ranges and step sizes are determined by the parameter&#39;s configured</span>
<span class="sd">        slider properties (slider_start, slider_end, slider_step_size).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Each togglable parameter gets its own float slider</span>
        <span class="n">sliders</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Process all constants in the model</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">hyperparam_name</span><span class="p">,</span>
            <span class="n">hyperparam_val</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">all_model_components_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Skip non-constants and non-togglable parameters</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hyperparam_val</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">Constant</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">hyperparam_val</span><span class="o">.</span><span class="n">is_togglable</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># If no dimensions OR if we are forcing uniformity across a multidimensional</span>
            <span class="c1"># array, just create a slider</span>
            <span class="k">if</span> <span class="n">hyperparam_val</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">hyperparam_val</span><span class="o">.</span><span class="n">enforce_uniformity</span><span class="p">:</span>
                <span class="n">sliders</span><span class="p">[</span><span class="n">hyperparam_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">EditableFloatSlider</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">hyperparam_name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">slider_start</span><span class="p">,</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">slider_end</span><span class="p">,</span>
                    <span class="n">step</span><span class="o">=</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">slider_step_size</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Otherwise, create a slider for each entry</span>
            <span class="k">for</span> <span class="n">arr_ind</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>

                <span class="c1"># Build the slider name</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hyperparam_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">arr_ind</span><span class="p">))</span><span class="si">}</span><span class="s2">]&quot;</span>

                <span class="c1"># Get the slider value</span>
                <span class="n">slider_val</span> <span class="o">=</span> <span class="n">hyperparam_val</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">arr_ind</span><span class="p">]</span>

                <span class="c1"># Add the slider</span>
                <span class="n">sliders</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pnw</span><span class="o">.</span><span class="n">EditableFloatSlider</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">slider_val</span><span class="p">,</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">slider_start</span><span class="p">,</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">slider_end</span><span class="p">,</span>
                    <span class="n">step</span><span class="o">=</span><span class="n">hyperparam_val</span><span class="o">.</span><span class="n">slider_step_size</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">sliders</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the underlying model with current slider values.</span>

<span class="sd">        This method reads the current values from all parameter sliders and</span>
<span class="sd">        updates the corresponding constant values in the model. It handles</span>
<span class="sd">        both scalar parameters and indexed multi-dimensional parameters.</span>

<span class="sd">        For indexed parameters, the method parses the slider name to extract</span>
<span class="sd">        the parameter name and array indices, then updates the appropriate</span>
<span class="sd">        array element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">paramname</span><span class="p">,</span> <span class="n">slider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_sliders</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Get the parameter name and the indices</span>
            <span class="n">paramname</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">_INDEX_EXTRACTOR</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">paramname</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">indices</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="o">...</span>

            <span class="c1"># Update the value of the constant</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">paramname</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">slider</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_draw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw new data from the model using current parameter values.</span>

<span class="sd">        This method generates samples from the model&#39;s prior predictive</span>
<span class="sd">        distribution using the current slider values and stores the results</span>
<span class="sd">        as an xarray Dataset for efficient manipulation and visualization.</span>

<span class="sd">        The number of samples and random seed are controlled by the</span>
<span class="sd">        corresponding widget values (draw_entry.value and draw_seed_entry.value).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">draw_entry</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">named_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">as_xarray</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">draw_seed_entry</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process raw xarray data into DataFrame format appropriate for plotting.</span>

<span class="sd">        This method transforms the xarray Dataset into a pandas DataFrame</span>
<span class="sd">        with appropriate structure for the selected visualization type. It</span>
<span class="sd">        handles data reshaping, grouping, and computation of derived quantities</span>
<span class="sd">        like cumulative probabilities for ECDF plots.</span>

<span class="sd">        The processing logic adapts based on the selected plot type:</span>
<span class="sd">        - ECDF plots: Computes cumulative probabilities and sorts appropriately</span>
<span class="sd">        - Relationship plots: Sorts by independent variable and adds separators</span>
<span class="sd">        - Other plots: Basic reshaping and filtering</span>

<span class="sd">        The method respects the current widget selections for target parameter,</span>
<span class="sd">        grouping dimension, and independent variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># We need to define aggregation functions for the different plot types</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">build_ecdfs</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>

            <span class="c1"># We need to record the original values of the dependent variable</span>
            <span class="n">new_df</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]]</span>

            <span class="c1"># Rank the target variable</span>
            <span class="n">new_df</span><span class="p">[</span><span class="s2">&quot;Cumulative Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">pct</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># Add the independent variable values</span>
            <span class="n">sort_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Cumulative Probability&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sort_keys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_label</span><span class="p">)</span>
                <span class="n">new_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_independent_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_independent_label</span><span class="p">]</span>

            <span class="c1"># Sort and return</span>
            <span class="k">return</span> <span class="n">new_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">sort_keys</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">build_relations</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
            <span class="c1"># Sort the data by the independent variable and add a NaN row to separate</span>
            <span class="c1"># the data by the appropriate dependent variable</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]}),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Gather the target data</span>
        <span class="n">selected_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span><span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Reshape the data as appropriate and convert the extracted data to a DataFrame.</span>
        <span class="c1"># We keep the grouping dimension separate from the stacked results.</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">selected_data</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
                <span class="n">stacked</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">dim</span>
                    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">selected_data</span><span class="o">.</span><span class="n">dims</span>
                    <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span>
                <span class="p">],</span>
                <span class="n">create_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Filter to just the columns needed. These are the grouping dimensions and</span>
        <span class="c1"># independent variables, if any.</span>
        <span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">target_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">target_cols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;stacked&quot;</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_cols</span><span class="p">]</span>

        <span class="c1"># Final processing for certain plots.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;ECDF&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="n">build_ecdfs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">build_ecdfs</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Relationship&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;stacked&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">build_relations</span><span class="p">)</span>

        <span class="c1"># Store the processed data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span> <span class="o">=</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_plot</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the plot display using current data and widget settings.</span>

<span class="sd">        This method reprocesses the current xarray data according to the</span>
<span class="sd">        selected visualization options and updates the plot display. It does</span>
<span class="sd">        not redraw data from the model, making it efficient for exploring</span>
<span class="sd">        different visualization modes.</span>

<span class="sd">        :param event: Panel event object (unused, for callback compatibility).</span>
<span class="sd">                     Defaults to None.</span>
<span class="sd">        :type event: Optional[Event]</span>

<span class="sd">        The method automatically selects appropriate plotting functions and</span>
<span class="sd">        styling based on the plot type dropdown selection, handling both</span>
<span class="sd">        hvplot-based plots and specialized HoloViews elements like violin plots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update plot button to loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Reformat the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_data</span><span class="p">()</span>

        <span class="c1"># Update the plot kwargs</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ECDF&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ecdf_kwargs</span><span class="p">,</span>
            <span class="s2">&quot;KDE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kde_kwargs</span><span class="p">,</span>
            <span class="s2">&quot;Violin&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_violin_kwargs</span><span class="p">,</span>
            <span class="s2">&quot;Relationship&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relationship_kwargs</span><span class="p">,</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]()</span>

        <span class="c1"># Update the plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Violin&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Violin</span><span class="p">(</span><span class="n">plot_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="c1"># Update plot button to not be loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_full_pipeline</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute complete model update and visualization pipeline.</span>

<span class="sd">        This method performs the full sequence of operations: updating model</span>
<span class="sd">        parameters from sliders, drawing new data from the updated model,</span>
<span class="sd">        and refreshing the plot display. It provides a complete refresh of</span>
<span class="sd">        the analysis when model parameters change.</span>

<span class="sd">        :param event: Panel event object (unused, for callback compatibility).</span>
<span class="sd">                     Defaults to None.</span>
<span class="sd">        :type event: Optional[Event]</span>

<span class="sd">        The method sets loading states on relevant buttons to provide user</span>
<span class="sd">        feedback during potentially time-consuming operations like data</span>
<span class="sd">        generation for complex models.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Buttons to loading mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_model_button</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Update the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_model</span><span class="p">()</span>

        <span class="c1"># Draw new data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_data</span><span class="p">()</span>

        <span class="c1"># Update the plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

        <span class="c1"># Buttons to not be loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_model_button</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="PriorPredictiveCheck.set_group_dim_options">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.set_group_dim_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_group_dim_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update grouping dimension options based on selected target parameter.</span>

<span class="sd">        This method configures the group dimension dropdown with appropriate</span>
<span class="sd">        options based on the dimensionality of the currently selected target</span>
<span class="sd">        parameter. It ensures that grouping options are only available for</span>
<span class="sd">        multi-dimensional parameters.</span>

<span class="sd">        :param event: Panel event containing the new target parameter selection</span>
<span class="sd">        :type event: Event</span>

<span class="sd">        The method updates both the dropdown options and the descriptive text</span>
<span class="sd">        showing dimension sizes to help users understand the data structure.</span>
<span class="sd">        If the previously selected grouping dimension is no longer valid,</span>
<span class="sd">        it automatically resets to a sensible default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the dimensions of the target variable</span>
        <span class="n">partial_opts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">new</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="c1"># Grouping can only be performed when we have more than one dimension</span>
        <span class="n">target_dim_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">partial_opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">target_dim_opts</span> <span class="o">+=</span> <span class="n">partial_opts</span>

        <span class="c1"># If the previous dependent dimension is not in the options, reset it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_dim_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">target_dim_opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Update the description of the grouping dimension</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">target_dim_opts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Group By (</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Update the dropdown options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">target_dim_opts</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.set_independent_var_options">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.set_independent_var_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_independent_var_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update independent variable options based on grouping dimension.</span>

<span class="sd">        This method configures the independent variable dropdown with coordinates</span>
<span class="sd">        and data variables that are compatible with the selected grouping</span>
<span class="sd">        dimension. Only variables that vary along the grouping dimension are</span>
<span class="sd">        included as options.</span>

<span class="sd">        :param event: Panel event containing the new grouping dimension selection</span>
<span class="sd">        :type event: Event</span>

<span class="sd">        The method scans both coordinates and data variables in the xarray</span>
<span class="sd">        Dataset to find suitable independent variables, ensuring compatibility</span>
<span class="sd">        with the selected visualization approach.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The independent variable must be a coordinate or data variable that contains</span>
        <span class="c1"># the `Group By` dimension.</span>
        <span class="n">independent_var_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">varname</span>
            <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xarray_data</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">]</span>

        <span class="c1"># If the previous independent variable is not in the options, reset it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">independent_var_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Update the dropdown options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">independent_var_opts</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.set_plot_type_options">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.set_plot_type_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_plot_type_options</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update available plot types based on current dimension selections.</span>

<span class="sd">        This method determines which visualization types are appropriate</span>
<span class="sd">        given the current selections for target parameter, grouping dimension,</span>
<span class="sd">        and independent variable. It enables more sophisticated plot types</span>
<span class="sd">        as more structure is specified.</span>

<span class="sd">        :param event: Panel event (used for callback compatibility is not used)</span>
<span class="sd">        :type event: Event</span>

<span class="sd">        Plot Type Logic:</span>

<span class="sd">        - ECDF and KDE: Always available for any parameter</span>
<span class="sd">        - Violin: Available when grouping dimension is selected</span>
<span class="sd">        - Relationship: Available when both grouping and independent variable are selected</span>

<span class="sd">        The method automatically selects the most sophisticated available plot</span>
<span class="sd">        type as the default when options change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We can always have an ECDF and KDE plot</span>
        <span class="n">plot_type_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ECDF&quot;</span><span class="p">,</span> <span class="s2">&quot;KDE&quot;</span><span class="p">]</span>
        <span class="n">default_plot</span> <span class="o">=</span> <span class="s2">&quot;ECDF&quot;</span>

        <span class="c1"># If a grouping dimension is set, then we can also have violin plots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">plot_type_opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Violin&quot;</span><span class="p">)</span>
            <span class="n">default_plot</span> <span class="o">=</span> <span class="s2">&quot;Violin&quot;</span>

        <span class="c1"># If an independent variable is set, then we can also have relationship</span>
        <span class="c1"># plots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">plot_type_opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Relationship&quot;</span><span class="p">)</span>
            <span class="n">default_plot</span> <span class="o">=</span> <span class="s2">&quot;Relationship&quot;</span>

        <span class="c1"># If the previous plot type is not in the options, reset it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_type_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">default_plot</span>

        <span class="c1"># Update to the plot type options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">plot_type_opts</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.display">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.display">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and return the complete interactive dashboard layout.</span>

<span class="sd">        This method assembles all widgets and the plot display into a</span>
<span class="sd">        comprehensive dashboard layout suitable for display in Jupyter</span>
<span class="sd">        notebooks, Panel applications, or web interfaces.</span>

<span class="sd">        :returns: Panel layout containing all interface elements</span>
<span class="sd">        :rtype: pn.Row</span>

<span class="sd">        The layout consists of:</span>

<span class="sd">        - Left panel: Model hyperparameter sliders and viewing options</span>
<span class="sd">        - Right panel: Interactive plot display that updates based on selections</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; check = PriorPredictiveCheck(model)</span>
<span class="sd">            &gt;&gt;&gt; dashboard = check.display() # For Jupyter notebook</span>
<span class="sd">            &gt;&gt;&gt; dashboard.servable()  # For web deployment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Organize widgets and plot</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
            <span class="n">pn</span><span class="o">.</span><span class="n">WidgetBox</span><span class="p">(</span>
                <span class="n">pn</span><span class="o">.</span><span class="n">WidgetBox</span><span class="p">(</span>
                    <span class="s2">&quot;# Model Hyperparameters&quot;</span><span class="p">,</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">float_sliders</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_seed_entry</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_entry</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_model_button</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">pn</span><span class="o">.</span><span class="n">WidgetBox</span><span class="p">(</span>
                    <span class="s2">&quot;# Viewing Options&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_dropdown</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_plot_button</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.get_kde_kwargs">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.get_kde_kwargs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_kde_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate keyword arguments for kernel density estimate plots.</span>

<span class="sd">        This method constructs the parameter dictionary needed for creating</span>
<span class="sd">        KDE visualizations using hvplot, including appropriate grouping</span>
<span class="sd">        and styling options.</span>

<span class="sd">        :returns: Dictionary of hvplot parameters for KDE plotting</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        The returned dictionary includes:</span>

<span class="sd">        - &#39;kind&#39;: Set to &#39;kde&#39; for kernel density estimation</span>
<span class="sd">        - &#39;x&#39;: `None` for KDE plots.</span>
<span class="sd">        - &#39;y&#39;: Target parameter name for the y-axis</span>
<span class="sd">        - &#39;by&#39;: Independent label for grouping (if applicable)</span>
<span class="sd">        - &#39;datashade&#39;: Disabled (False) for KDE plots to maintain clarity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;kde&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;by&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_label</span><span class="p">,</span>
            <span class="s2">&quot;datashade&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.get_ecdf_kwargs">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.get_ecdf_kwargs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ecdf_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate keyword arguments for empirical CDF plots.</span>

<span class="sd">        This method constructs the parameter dictionary needed for creating</span>
<span class="sd">        ECDF visualizations using hvplot, including cumulative probability</span>
<span class="sd">        calculations and appropriate hover interactions.</span>

<span class="sd">        :returns: Dictionary of hvplot parameters for ECDF plotting</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        The returned dictionary includes:</span>

<span class="sd">        - &#39;kind&#39;: Set to &#39;line&#39; for step-like ECDF appearance</span>
<span class="sd">        - &#39;x&#39;: Target parameter values</span>
<span class="sd">        - &#39;y&#39;: &#39;Cumulative Probability&#39; (computed during data processing)</span>
<span class="sd">        - &#39;by&#39;: Independent label for grouping multiple ECDFs</span>
<span class="sd">        - &#39;datashade&#39;: Disabled (False) for ECDF plots to maintain clarity</span>
<span class="sd">        - &#39;hover&#39;: Set to &#39;hline&#39; for horizontal hover lines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;Cumulative Probability&quot;</span><span class="p">,</span>
            <span class="s2">&quot;by&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_label</span><span class="p">,</span>
            <span class="s2">&quot;datashade&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;hover&quot;</span><span class="p">:</span> <span class="s2">&quot;hline&quot;</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.get_violin_kwargs">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.get_violin_kwargs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_violin_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate arguments for violin plot creation.</span>

<span class="sd">        This method constructs the arguments needed for creating violin plots</span>
<span class="sd">        using HoloViews, handling complex grouping scenarios and determining</span>
<span class="sd">        appropriate categorization based on data structure.</span>

<span class="sd">        :returns: Dictionary containing plot arguments and dimensions</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        The method handles multiple grouping scenarios:</span>

<span class="sd">        - Single grouping by dimension index</span>
<span class="sd">        - Grouping by both dimension and independent variable</span>
<span class="sd">        - Automatic determination of primary vs. secondary grouping</span>

<span class="sd">        The returned dictionary includes:</span>

<span class="sd">        - &#39;args&#39;: Tuple of (groups..., values) for HoloViews Violin constructor</span>
<span class="sd">        - &#39;kdims&#39;: List of key dimension names</span>
<span class="sd">        - &#39;vdims&#39;: Value dimension name (target parameter)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This is only an option if we have a grouping dimension</span>
        <span class="n">group_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="c1"># If the independent label is provided, then it is the grouping variable</span>
        <span class="c1"># and the group index is the category variable IF there are more unique</span>
        <span class="c1"># combinations of indices and independent labels than there are group indices</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">independent_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span>
            <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">group_indices</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span><span class="p">[</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_indices</span><span class="p">,</span> <span class="n">independent_labels</span><span class="p">]</span>
                <span class="n">kdims</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">independent_labels</span><span class="p">]</span>
                <span class="n">kdims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="c1"># Otherwise, we just have the group indices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_indices</span><span class="p">]</span>
            <span class="n">kdims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">groups</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_processed_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
            <span class="p">),</span>
            <span class="s2">&quot;kdims&quot;</span><span class="p">:</span> <span class="n">kdims</span><span class="p">,</span>
            <span class="s2">&quot;vdims&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="PriorPredictiveCheck.get_relationship_kwargs">
<a class="viewcode-back" href="../../../api/plotting/prior_predictive.html#scistanpy.plotting.prior_predictive.PriorPredictiveCheck.get_relationship_kwargs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_relationship_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate keyword arguments for relationship plots.</span>

<span class="sd">        This method constructs the parameter dictionary for creating</span>
<span class="sd">        relationship visualizations that show how parameters vary with</span>
<span class="sd">        respect to independent variables, using datashading for performance.</span>

<span class="sd">        :returns: Dictionary of hvplot parameters for relationship plotting</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        The returned dictionary includes:</span>
<span class="sd">        - kind: Set to &#39;line&#39; for continuous relationships</span>
<span class="sd">        - x: Independent variable name</span>
<span class="sd">        - y: Target parameter name</span>
<span class="sd">        - datashade: Enabled (True) for performance with large datasets</span>
<span class="sd">        - dynamic: Disabled (False), resulting in all data being embedded in output</span>
<span class="sd">        - aggregator: Set to &#39;count&#39; for density-based coloring</span>
<span class="sd">        - cmap: &#39;inferno&#39; colormap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;by&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;datashade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;aggregator&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;inferno&quot;</span><span class="p">,</span>
        <span class="p">}</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_independent_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the effective independent label for plotting.</span>

<span class="sd">        This property provides a unified interface for determining which</span>
<span class="sd">        variable should be used as the independent label in plots, following</span>
<span class="sd">        a priority hierarchy based on user selections.</span>

<span class="sd">        :returns: Name of the independent variable, or None if not applicable</span>
<span class="sd">        :rtype: Optional[str]</span>

<span class="sd">        Priority order:</span>
<span class="sd">        1. Independent variable dropdown selection (if not empty)</span>
<span class="sd">        2. Group dimension dropdown selection (if not empty)</span>
<span class="sd">        3. None (for simple univariate plots)</span>

<span class="sd">        This property enables consistent handling of grouping and independent</span>
<span class="sd">        variables across different visualization types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_var_dropdown</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_dim_dropdown</span><span class="o">.</span><span class="n">value</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">SciStanPy</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">SciStanPy API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../scistanpy.html">scistanpy</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Microsoft Corporation.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>