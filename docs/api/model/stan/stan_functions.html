<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Stan Functions Library Reference &#8212; SciStanPy Alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=6b921976"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Stan Model API Reference" href="stan_model.html" />
    <link rel="prev" title="Stan Integration" href="index.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="stan-functions-library-reference">
<h1>Stan Functions Library Reference<a class="headerlink" href="#stan-functions-library-reference" title="Link to this heading">¶</a></h1>
<p>This reference covers the Stan function libraries that provide specialized probability distributions and mathematical operations for SciStanPy models.</p>
<section id="stan-functions-overview">
<h2>Stan Functions Overview<a class="headerlink" href="#stan-functions-overview" title="Link to this heading">¶</a></h2>
<p>SciStanPy includes a comprehensive library of Stan functions that extend the standard Stan library with specialized distributions and operations commonly needed in scientific modeling. These functions are automatically included in generated Stan programs based on the model components used.</p>
</section>
<section id="function-library-organization">
<h2>Function Library Organization<a class="headerlink" href="#function-library-organization" title="Link to this heading">¶</a></h2>
<p>The Stan functions are organized into several specialized libraries:</p>
<dl class="simple">
<dt><strong>Multinomial Distributions</strong></dt><dd><p>Enhanced multinomial distributions with multiple parameterizations</p>
</dd>
<dt><strong>Exp-Transformed Distributions</strong></dt><dd><p>Log-transformed distributions for improved numerical stability</p>
</dd>
<dt><strong>Growth Models</strong></dt><dd><p>Specialized functions for temporal and population dynamics</p>
</dd>
<dt><strong>Sequence Operations</strong></dt><dd><p>Convolution and pattern matching for sequence analysis</p>
</dd>
</dl>
</section>
<section id="multinomial-function-library">
<h2>Multinomial Function Library<a class="headerlink" href="#multinomial-function-library" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">multinomial.stanfunctions</span></code></p>
<p><strong>Functions Provided:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Log multinomial coefficient</span>
<span class="kt">real</span> <span class="n">log_multinomial_coeff</span><span class="p">(</span><span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>

<span class="c1">// Multinomial with log-theta parameterization</span>
<span class="kt">real</span> <span class="n">multinomial_logtheta_unnorm_lpmf</span><span class="p">(</span><span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">log_theta</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">multinomial_logtheta_norm_lpmf</span><span class="p">(</span><span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">log_theta</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">multinomial_logtheta_manual_norm_lpmf</span><span class="p">(</span><span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">log_theta</span><span class="p">,</span> <span class="kt">real</span> <span class="n">coeff</span><span class="p">)</span>
<span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">multinomial_logtheta_rng</span><span class="p">(</span><span class="kt">vector</span> <span class="n">log_theta</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Usage in SciStanPy:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatically included when using MultinomialLogit</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">MultinomialLogit</span><span class="p">(</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">logits</span><span class="o">=</span><span class="n">log_probabilities</span><span class="p">,</span>
    <span class="n">observable</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Mathematical Background:</strong></p>
<p>The multinomial distribution with log-theta parameterization uses:</p>
<div class="math notranslate nohighlight">
\[p(n | \log\theta) = \binom{N}{n_1, \ldots, n_k} \prod_{i=1}^k \theta_i^{n_i}\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta_i = \exp(\log\theta_i)\)</span> and <span class="math notranslate nohighlight">\(N = \sum_i n_i\)</span>.</p>
</section>
<section id="exp-exponential-distribution">
<h2>Exp-Exponential Distribution<a class="headerlink" href="#exp-exponential-distribution" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">expexponential.stanfunctions</span></code></p>
<p><strong>Functions Provided:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Exp-exponential log probability density</span>
<span class="kt">real</span> <span class="n">expexponential_lpdf</span><span class="p">(</span><span class="kt">real</span> <span class="n">y</span><span class="p">,</span> <span class="kt">real</span> <span class="n">beta</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">expexponential_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">beta</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">expexponential_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">real</span> <span class="n">beta</span><span class="p">)</span>

<span class="c1">// Random number generation</span>
<span class="kt">real</span> <span class="n">expexponential_rng</span><span class="p">(</span><span class="kt">real</span> <span class="n">beta</span><span class="p">)</span>
<span class="kt">array</span><span class="p">[]</span> <span class="kt">real</span> <span class="n">expexponential_rng</span><span class="p">(</span><span class="kt">vector</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Usage in SciStanPy:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For log-transformed exponential variables</span>
<span class="n">log_lifetime</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ExpExponential</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">observable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Mathematical Background:</strong></p>
<p>If <span class="math notranslate nohighlight">\(X \sim \text{Exponential}(\beta)\)</span>, then <span class="math notranslate nohighlight">\(Y = \log(X)\)</span> follows the exp-exponential distribution:</p>
<div class="math notranslate nohighlight">
\[p(y | \beta) = \beta \exp(y - \beta e^y)\]</div>
</section>
<section id="exp-dirichlet-distribution">
<h2>Exp-Dirichlet Distribution<a class="headerlink" href="#exp-dirichlet-distribution" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">expdirichlet.stanfunctions</span></code></p>
<p><strong>Functions Provided:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Beta function utilities</span>
<span class="kt">real</span> <span class="n">vectorized_lbeta</span><span class="p">(</span><span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">vector</span> <span class="n">inv_ilr_log_simplex_constrain_jacobian</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">)</span>

<span class="c1">// Exp-Dirichlet log probability density</span>
<span class="kt">real</span> <span class="n">expdirichlet_unnorm_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">expdirichlet_norm_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>

<span class="c1">// Random number generation</span>
<span class="kt">vector</span> <span class="n">expdirichlet_rng</span><span class="p">(</span><span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Usage in SciStanPy:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For log-simplex variables</span>
<span class="n">log_proportions</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ExpDirichlet</span><span class="p">(</span>
    <span class="n">alpha</span><span class="o">=</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="n">observable</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Mathematical Background:</strong></p>
<p>If <span class="math notranslate nohighlight">\(X \sim \text{Dirichlet}(\alpha)\)</span>, then <span class="math notranslate nohighlight">\(Y = \log(X)\)</span> follows the exp-Dirichlet distribution:</p>
<div class="math notranslate nohighlight">
\[p(y | \alpha) = \frac{\Gamma(\sum_i \alpha_i)}{\prod_i \Gamma(\alpha_i)} \exp\left(\sum_i (\alpha_i - 1) y_i\right)\]</div>
</section>
<section id="exp-lomax-distribution">
<h2>Exp-Lomax Distribution<a class="headerlink" href="#exp-lomax-distribution" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">explomax.stanfunctions</span></code></p>
<p><strong>Functions Provided:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Exp-Lomax log probability density (multiple overloads)</span>
<span class="kt">real</span> <span class="n">explomax_lpdf</span><span class="p">(</span><span class="kt">real</span> <span class="n">y</span><span class="p">,</span> <span class="kt">real</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">real</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">explomax_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">explomax_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">real</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">real</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">explomax_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">real</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">real</span> <span class="n">explomax_lpdf</span><span class="p">(</span><span class="kt">vector</span> <span class="n">y</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">real</span> <span class="n">alpha</span><span class="p">)</span>

<span class="c1">// Random number generation (multiple overloads)</span>
<span class="kt">real</span> <span class="n">explomax_rng</span><span class="p">(</span><span class="kt">real</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">real</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">array</span><span class="p">[]</span> <span class="kt">real</span> <span class="n">explomax_rng</span><span class="p">(</span><span class="kt">vector</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">real</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">array</span><span class="p">[]</span> <span class="kt">real</span> <span class="n">explomax_rng</span><span class="p">(</span><span class="kt">real</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
<span class="kt">array</span><span class="p">[]</span> <span class="kt">real</span> <span class="n">explomax_rng</span><span class="p">(</span><span class="kt">vector</span> <span class="n">lambda</span><span class="p">,</span> <span class="kt">vector</span> <span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Usage in SciStanPy:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For log-transformed Lomax variables (heavy-tailed distributions)</span>
<span class="n">log_size</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ExpLomax</span><span class="p">(</span>
    <span class="n">lambda_</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">observable</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Mathematical Background:</strong></p>
<p>If <span class="math notranslate nohighlight">\(X \sim \text{Lomax}(\lambda, \alpha)\)</span>, then <span class="math notranslate nohighlight">\(Y = \log(X)\)</span> follows the exp-Lomax distribution:</p>
<div class="math notranslate nohighlight">
\[p(y | \lambda, \alpha) = \frac{\alpha \lambda^\alpha \exp(y)}{(\lambda + \exp(y))^{\alpha + 1}}\]</div>
</section>
<section id="sequence-convolution-functions">
<h2>Sequence Convolution Functions<a class="headerlink" href="#sequence-convolution-functions" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">pssm.stanfunctions</span></code></p>
<p><strong>Functions Provided:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Basic convolution</span>
<span class="kt">real</span> <span class="n">convolve</span><span class="p">(</span><span class="kt">array</span><span class="p">[]</span> <span class="kt">vector</span> <span class="n">weights</span><span class="p">,</span> <span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">seq</span><span class="p">)</span>

<span class="c1">// Sequence convolution</span>
<span class="kt">vector</span> <span class="n">convolve_sequence</span><span class="p">(</span><span class="kt">array</span><span class="p">[]</span> <span class="kt">vector</span> <span class="n">weights</span><span class="p">,</span> <span class="kt">array</span><span class="p">[]</span> <span class="kt">int</span> <span class="n">seq</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Usage in SciStanPy:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For sequence analysis (e.g., protein sequences)</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Encoded sequence</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">convolved</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">convolve_sequence</span><span class="p">(</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
    <span class="n">ordinals</span><span class="o">=</span><span class="n">sequence</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Mathematical Background:</strong></p>
<p>1D convolution for sequences:</p>
<div class="math notranslate nohighlight">
\[(f * g)[i] = \sum_{j=0}^{K-1} f[j] \cdot g[i+j]\]</div>
<p>where <span class="math notranslate nohighlight">\(K\)</span> is the kernel size and the sequence is ordinally encoded.</p>
</section>
<section id="function-integration-process">
<h2>Function Integration Process<a class="headerlink" href="#function-integration-process" title="Link to this heading">¶</a></h2>
<p><strong>Automatic Inclusion:</strong></p>
<p>Functions are automatically included based on model components:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This model will automatically include multinomial.stanfunctions</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ModelWithMultinomial</span><span class="p">(</span><span class="n">ssp</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">MultinomialLogit</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">logits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">observable</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
</pre></div>
</div>
<p><strong>Include Path Configuration:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Functions are included via Stan&#39;s include mechanism</span>
<span class="c1"># SciStanPy automatically configures include paths</span>

<span class="c1"># Generated Stan code includes:</span>
<span class="c1"># functions {</span>
<span class="c1">#     #include &lt;multinomial.stanfunctions&gt;</span>
<span class="c1">#     // Other required functions...</span>
<span class="c1"># }</span>
</pre></div>
</div>
<p><strong>Function Optimization:</strong></p>
<ul class="simple">
<li><p><strong>Duplicate Elimination</strong>: Multiple uses of the same distribution type result in single function inclusion</p></li>
<li><p><strong>Dependency Resolution</strong>: Related functions are included together (e.g., MultinomialLogit includes Multinomial functions)</p></li>
<li><p><strong>Vectorization</strong>: Functions support both scalar and vector operations for efficiency</p></li>
</ul>
</section>
<section id="numerical-stability-features">
<h2>Numerical Stability Features<a class="headerlink" href="#numerical-stability-features" title="Link to this heading">¶</a></h2>
<p><strong>Log-Space Computations:</strong></p>
<p>All exp-transformed distributions use log-space arithmetic to prevent:</p>
<ul class="simple">
<li><p><strong>Overflow</strong>: For very large values</p></li>
<li><p><strong>Underflow</strong>: For very small probabilities</p></li>
<li><p><strong>Precision Loss</strong>: In extreme parameter ranges</p></li>
</ul>
<p><strong>Robust Implementations:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Example: Numerically stable log-sum-exp operations</span>
<span class="kt">real</span> <span class="n">stable_log_prob</span> <span class="o">=</span> <span class="nb">log_sum_exp</span><span class="p">(</span><span class="n">log_alpha</span> <span class="o">+</span> <span class="n">log_lambda</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span>
                                   <span class="n">log_normalization_constant</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Gradient Stability:</strong></p>
<p>Functions are implemented to provide stable gradients for:</p>
<ul class="simple">
<li><p><strong>HMC Sampling</strong>: Smooth energy landscapes</p></li>
<li><p><strong>Variational Inference</strong>: Stable gradient estimates</p></li>
<li><p><strong>Optimization</strong>: Reliable convergence properties</p></li>
</ul>
</section>
<section id="custom-function-development">
<h2>Custom Function Development<a class="headerlink" href="#custom-function-development" title="Link to this heading">¶</a></h2>
<p><strong>Adding New Functions:</strong></p>
<p>To add new Stan functions to SciStanPy:</p>
<ol class="arabic simple">
<li><p><strong>Create .stanfunctions file</strong> with function implementations</p></li>
<li><p><strong>Add to include paths</strong> in Stan integration module</p></li>
<li><p><strong>Register with model components</strong> that use the functions</p></li>
<li><p><strong>Test numerical stability</strong> and gradient computation</p></li>
</ol>
<p><strong>Function Template:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Template for new distribution function</span>
<span class="kt">real</span> <span class="n">my_distribution_lpdf</span><span class="p">(</span><span class="kt">real</span> <span class="n">y</span><span class="p">,</span> <span class="kt">real</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">real</span> <span class="n">param2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Implement log probability density</span>
    <span class="c1">// Use log-space operations for stability</span>
    <span class="c1">// Include proper normalization constants</span>
    <span class="k">return</span> <span class="n">log_prob_value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">real</span> <span class="n">my_distribution_rng</span><span class="p">(</span><span class="kt">real</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">real</span> <span class="n">param2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Implement random number generation</span>
    <span class="c1">// Use Stan&#39;s built-in RNG functions</span>
    <span class="k">return</span> <span class="n">random_sample</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Best Practices for Function Development:</strong></p>
<ol class="arabic simple">
<li><p><strong>Use log-space arithmetic</strong> for probability computations</p></li>
<li><p><strong>Implement multiple overloads</strong> for scalar and vector operations</p></li>
<li><p><strong>Include proper normalization</strong> constants</p></li>
<li><p><strong>Test against reference implementations</strong> for correctness</p></li>
<li><p><strong>Validate numerical stability</strong> across parameter ranges</p></li>
<li><p><strong>Document mathematical background</strong> and usage patterns</p></li>
</ol>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading">¶</a></h2>
<p><strong>Vectorization Benefits:</strong></p>
<div class="highlight-stan notranslate"><div class="highlight"><pre><span></span><span class="c1">// Vectorized operations are more efficient</span>
<span class="kt">vector</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="n">log_probs</span> <span class="o">=</span> <span class="n">my_distribution_lpdf</span><span class="p">(</span><span class="n">y_vector</span> <span class="p">|</span> <span class="n">param_vector</span><span class="p">);</span>

<span class="c1">// Than element-wise operations</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mf">1</span><span class="o">:</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">log_probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_distribution_lpdf</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">|</span> <span class="n">param</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Memory Efficiency:</strong></p>
<ul class="simple">
<li><p><strong>In-place operations</strong>: Minimize temporary array creation</p></li>
<li><p><strong>Efficient indexing</strong>: Use appropriate array vs matrix structures</p></li>
<li><p><strong>Loop optimization</strong>: Minimize nested loop complexity</p></li>
</ul>
<p>The Stan functions library provides the mathematical foundation for SciStanPy’s advanced probability distributions and specialized operations, enabling sophisticated scientific modeling while maintaining numerical stability and computational efficiency.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">SciStanPy</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">SciStanPy API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../custom_types.html">Custom Types API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../defaults.html">Defaults API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exceptions.html">Exceptions API Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Model API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plotting/index.html">Plotting Subpackage API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations.html">Operations API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utils.html">Utils API Reference</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">SciStanPy API Reference</a><ul>
  <li><a href="../index.html">Model API Reference</a><ul>
  <li><a href="index.html">Stan Integration</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Stan Integration</a></li>
      <li>Next: <a href="stan_model.html" title="next chapter">Stan Model API Reference</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Microsoft Corporation.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/api/model/stan/stan_functions.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>