description: Runs HMC for the pdz landscapes.

target:
  service: sing
  workspace_name: bjwamltws
  name: msrresrchlab

environment:
  image: dms_stan:latest
  registry: bjwamltcr.azurecr.io

data:
  remote_dir: data/paraphrase/

search:
  max_trials: 750
  parallel_trials: 16
  job_template:
    name: "{experiment_name:s}_pdz_{subset:s}_{rate_dist:s}_{growth_func:s}"
    sku: 1G32
    preemptible: False
    command:
      - python dms_stan/pipelines/approximate_map_flip.py
        --dataset pdz
        --subset {subset}
        --rate_dist {rate_dist}
        --growth_func {growth_func}
        --flip_data $$AMLT_DATA_DIR
        --output_dir $$AMLT_OUTPUT_DIR
        --sample_batch_size 100
    submit_args:
      max_run_duration_seconds: 1209600
      env:
        _AZUREML_SINGULARITY_JOB_UAI: /subscriptions/84a94086-6c26-4611-8249-b3549944c86c/resourcegroups/bjwamlt/providers/Microsoft.ManagedIdentity/userAssignedIdentities/bjwamltuami
    identity: managed
  type: hyperdrive
  sampling: grid
  params:
    - name: subset
      values: choice("cript-c", "cript-n", "cis", "trans-1", "trans-2")
    - name: rate_dist
      values: choice("exponential", "gamma", "lomax")
    - name: growth_func
      values: choice("exponential", "logistic")