description: Runs HMC for the FLIPv3 landscapes.

target:
  service: sing
  workspace_name: bjwamltws
  name: msrresrchvc

environment:
  image: dms_stan:latest
  registry: bjwamltcr.azurecr.io

data:
  remote_dir: data/paraphrase/

search:
  max_trials: 750
  job_template:
    name: "{experiment_name:s}_{job_ind:s}_{rate_dist:s}_{growth_func:s}"
    sku: C4
    preemptible: False
    command:
      - dset_info=($(sed -n {job_ind}p dset_combos.txt))
      - python dms_stan/pipelines/mcmc_flip.py
        --dataset ${dset_info[0]}
        --subset ${dset_info[1]}
        --rate_dist {rate_dist}
        --growth_func {growth_func}
        --flip_data $$AMLT_DATA_DIR
        --output_dir $$AMLT_DIRSYNC_DIR
        --use_dask
        --force_compile
    submit_args:
      max_run_duration_seconds: 1209600
      env:
        _AZUREML_SINGULARITY_JOB_UAI: /subscriptions/84a94086-6c26-4611-8249-b3549944c86c/resourcegroups/bjwamlt/providers/Microsoft.ManagedIdentity/userAssignedIdentities/bjwamltuami
        AMLT_DIRSYNC_FREQ: 600
    identity: managed
  type: hyperdrive
  sampling: grid
  params:
    - name: job_ind
      values: range(0, 15)
    - name: rate_dist
      values: choice("exponential", "gamma", "lomax")
    - name: growth_func
      values: choice("exponential", "logistic")